(this.webpackJsonptodo=this.webpackJsonptodo||[]).push([[0],{112:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.DATA=t.MESSAGE=t.PEER_REMOVE=t.PEER=t.ERROR=t.CLOSE=t.READY=t.OPEN=t.StoreManager=void 0;var a=n(346);Object.defineProperty(t,"StoreManager",{enumerable:!0,get:function(){return a.StoreManager}}),o(n(72),t);var i=n(26);Object.defineProperty(t,"OPEN",{enumerable:!0,get:function(){return i.OPEN}}),Object.defineProperty(t,"READY",{enumerable:!0,get:function(){return i.READY}}),Object.defineProperty(t,"CLOSE",{enumerable:!0,get:function(){return i.CLOSE}}),Object.defineProperty(t,"ERROR",{enumerable:!0,get:function(){return i.ERROR}}),Object.defineProperty(t,"PEER",{enumerable:!0,get:function(){return i.PEER}}),Object.defineProperty(t,"PEER_REMOVE",{enumerable:!0,get:function(){return i.PEER_REMOVE}}),Object.defineProperty(t,"MESSAGE",{enumerable:!0,get:function(){return i.MESSAGE}}),Object.defineProperty(t,"DATA",{enumerable:!0,get:function(){return i.DATA}})},117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var r=n(22);t.Container=function(e){var t=e.children;return r.jsx("div",Object.assign({className:"\n        flex flex-row \n        bg-gray-100\n        border-b border-gray-400\n        text-sm font-mono"},{children:t}),void 0)}},118:function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Dropdown=void 0;var o=n(22);t.Dropdown=function(e){var t=e.open,n=e.width,a=void 0===n?200:n,i=e.children,s=r(e,["open","width","children"]);return o.jsx("div",Object.assign({className:[t?"block":"hidden","absolute mt-1 z-20","shadow-lg","border border-gray-400","divide-y divide-gray-400","bg-white "].join(" "),css:{width:a}},s,{children:i}),void 0)}},119:function(e,t,n){"use strict";var r=n(63),o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.DropdownWrapper=void 0;var a=n(22),i=n(2),s=n(38),c=n(118);t.DropdownWrapper=function(e){var t=e.children,n=e.buttonText,u=e.disabled,l=o(e,["children","buttonText","disabled"]),d=i.useState(!1),f=r(d,2),h=f[0],p=f[1];return a.jsxs("div",Object.assign({className:"relative inline-block"},l,{children:[a.jsx(s.Button,Object.assign({onFocus:function(){return setTimeout((function(){return p(!h)}))},onBlur:function(){return setTimeout((function(){return p(!1)}),500)},disabled:u},{children:n}),void 0),a.jsx(c.Dropdown,Object.assign({open:h},{children:t}),void 0)]}),void 0)}},183:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomUserName=t.randomDiscoveryKey=void 0;var r=n(75),o=function(e){return e[Math.floor(Math.random()*e.length)]},a=[r.predicates,r.objects];t.randomDiscoveryKey=function(){return a.map(o).join("-")};var i=[["admirable","admiral","baron","baroness","brave","captain","charming","chatty","clever","colonel","commander","corporal","countess","dame","delightful","detective","doctor","duke","eccentric","efficient","elusive","entertaining","excellent","friendly","funky","funny","general","hilarious","lady","lieutenant","little","lovely","madam","major","miss","missus","mister","mistress","monsieur","mysterious","nervous","old","president","professor","remarkable","reverend","senator","se\xf1or","se\xf1ora","sergeant","strange","sweet","tame","trustworthy","viscount","wise"],["aardvark","aardwolf","abalone","albacore","albatross","alewife","alligator","alpaca","anaconda","anchovy","angelfish","angler","ant","anteater","antelope","ape","aphid","armadillo","baboon","badger","bandicoot","barnacle","barracuda","bat","bear","beaver","bedbug","beetle","beluga","bison","blackbird","bluebeetle","bluebird","bluebottle","bluejay","boar","bobcat","bowerbird","bowfin","bowhead","boxfish","bristletail","buffalo","bullfinch","bullfrog","bumblebee","bushbaby","butterfly","buzzard","caiman","camel","canary","capuchin","capybara","cardinal","caribou","caterpillar","catfish","cavefish","centipede","chameleon","cheetah","chickadee","chicken","chickenhawk","chimpanzee","chinchilla","chipmunk","cobra","cockatoo","condor","copperhead","cormorant","cowbird","cowfish","coyote","crayfish","cricket","crocodile","dingo","puppydog","kittycat","bunnyrabbit","dogfish","dolphin","donkey","dragonfly","eagle","earthworm","egret","eland","elephant","elk","falcon","ferret","firefly","flamingo","flatworm","flicker","flounder","flycatcher","frog","fruitfly","gazelle","gecko","gerbil","gibbon","giraffe","gnatcatcher","goat","goldfinch","goose","gopher","gorilla","grasshopper","groundhog","guanaco","guitarfish","haddock","hagfish","halibut","hamster","hartebeest","hawksbill","hedgehog","herring","honeybadger","horsefly","hummingbird","humpback","hyena","iguana","impala","jackal","jackrabbit","jaguar","jellyfish","kangaroo","kingfisher","kingsnake","koalabear","kookaburra","lacewing","ladybug","lemming","lemur","leopard","lion","lizard","llama","lobster","locust","lovebird","lynx","macaque","mackerel","magpie","mallard","mamba","manatee","mandrill","mantis","meadowlark","meerkat","merlin","millipede","mockingbird","mongoose","monkey","moose","mosquito","mouse","mudpuppy","mudskipper","muskrat","narwhal","nautilus","nighthawk","nightingale","ocelot","octopus","okapi","opossum","orangutan","oryx","osprey","ostrich","otter","owl","oyster","oystercatcher","panda","pangolin","panther","parakeet","parrot","parrotfish","partridge","peacock","pelican","penguin","pheasant","pig","pigeon","piranha","polecat","porcupine","porpoise","possum","ptarmigan","puffin","puma","python","quail","quetzal","raccoon","rattlesnake","reindeer","rhinoceros","roadrunner","rotifer","salamander","salmon","sandfish","sardine","scallop","scorpion","seasquirt","seagull","seahorse","seal","shark","sheep","shrew","shrimp","sidewinder","silkworm","silverfish","skunk","skylark","sloth","slug","snail","snake","sparrow","sparrowhawk","spider","sponge","spoonbill","springbok","squid","squirrel","starfish","starling","stingray","stork","sturgeon","swallow","swan","swordfish","tadpole","tapir","tarantula","terrapin","tiger","tilapia","toad","tortoise","toucan","treefrog","treesnake","triggerfish","trout","tuna","turkey","turtle","urchin","vicu\xf1a","viper","vulture","wallaby","walrus","warthog","wasp","whitefish","wildebeest","wolf","wolverine","wombat","woodchuck","woodpecker","yak","yellowjacket","zebra"]];t.randomUserName=function(){return i.map(o).join(".")}},189:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getClock=t.getMissingChanges=t.isMoreRecent=t.mergeClocks=t.EMPTY_CLOCK=void 0;var s=a(n(194)),c=i(n(58)),u=n(365);t.EMPTY_CLOCK={},t.mergeClocks=function(e,t){return s.mergeWith((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.max(e,t)}),e,t)};t.isMoreRecent=function(e,t){if(void 0===t)return!0;return Object.keys(Object.assign(Object.assign({},e),t)).some((function(n){return(e[n]||0)>(t[n]||0)}))};var l=Object.assign(Object.assign({},c.default),{getMissingChanges:function(e,t){if(void 0===t)return[];var n=c.default.Frontend.getBackendState(e);return c.default.Backend.getMissingChanges(n,t)},getClock:function(e){return c.default.Frontend.getBackendState(e).getIn(["opSet","clock"])}});t.getMissingChanges=function(e,t){return l.getMissingChanges(e,u.Map(t))};t.getClock=function(e){return u.Map(l.getClock(e)).toJS()}},190:function(e,t,n){"use strict";var r=n(17),o=n(35),a=n(45),i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.performAuthHandshake=t.getTeamManager=t.TeamManager=void 0;var d=l(n(58)),f=c(n(64)),h=n(26),p=n(72),v=[],b=function(){function e(){o(this,e),this.teams=new Map}return a(e,[{key:"getInvitation",value:function(e){var t=this.teams.get(e);return t&&t[1]}},{key:"instantiateTeamIfAvailable",value:function(e,t,n){return u(this,void 0,void 0,r.mark((function o(){var a,i,s,c;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a=this.teams.get(t))){r.next=5;break}return r.abrupt("return",a[0]);case 5:if(!n){r.next=9;break}this.teams.set(t,[void 0,n]),r.next=19;break;case 9:if(!e.has("_AUTH")){r.next=19;break}return r.t0=p,r.next=13,e.get("_AUTH");case 13:return r.t1=r.sent,i=r.t0.ensure.call(r.t0,r.t1),s=p.ensure(f.loadUser()),c=new f.Team({source:i,context:{user:s}}),this.addListener(e,t,c),r.abrupt("return",c);case 19:case"end":return r.stop()}}),o,this)})))}},{key:"instantiateTeamDefinitely",value:function(e,t,n){return u(this,void 0,void 0,r.mark((function o(){var a,i,s;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a=this.teams.get(t))||!a[0]){r.next=5;break}throw new Error("BUG: Should not already have a team loaded up");case 5:return e.set("_AUTH",d.default.from(g(n))),i=p.ensure(f.loadUser()),s=new f.Team({source:n,context:{user:i}}),r.next=10,this.addTeam(e,t,s);case 10:return r.abrupt("return",s);case 11:case"end":return r.stop()}}),o,this)})))}},{key:"addTeam",value:function(e,t,n){return u(this,void 0,void 0,r.mark((function o(){return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.teams.has(t)){r.next=2;break}throw new Error("BUG? seems this already has a Team");case 2:return this.teams.set(t,[n,void 0]),r.next=5,e.set("_AUTH",d.default.from(g(n.chain)));case 5:this.addListener(e,t,n);case 6:case"end":return r.stop()}}),o,this)})))}},{key:"addListener",value:function(e,t,n){var o=this;n.on("updated",(function(t){var a=t.head;return u(o,void 0,void 0,r.mark((function t(){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=g(n.chain.links[a]),!(v.length>0)){t.next=5;break}return t.next=4,Promise.all(v);case 4:v.splice(0,v.length);case 5:v.push(e.change("_AUTH",(function(e){if(e.root||(e.root=a),e.links||(e.links={}),!e.links[a]){e.head=a,e.links[a]=o;for(var t=o;;){var r=t.body.prev;if(!r)break;var i=n.chain.links[r];if(e.links[r])break;e.links[r]=g(i),t=i}}})));case 6:case"end":return t.stop()}}),t)})))}))}}]),e}();t.TeamManager=b;var y=new b;function m(){return y}function g(e){return JSON.parse(JSON.stringify(e))}t.getTeamManager=m,t.performAuthHandshake=function(e,t,n,o){return u(this,void 0,void 0,r.mark((function a(){var i,s,c=this;return r.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(e,t){o.send(JSON.stringify({action:e,payload:t}))},console.log("generating proof using invitation:",n),s=f.generateProof(n.invitationSeed,n.username),console.log("Sending AUTH:JOIN to peer"),i("AUTH:JOIN",s),a.abrupt("return",new Promise((function(a,i){o.addEventListener(h.MESSAGE,(function i(l){var d=l.data;return u(c,void 0,void 0,r.mark((function c(){var u,l,p,v,b,y,g;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=JSON.parse(d),l=u.type,p=u.action,v=u.payload,"HELLO"!==l){r.next=4;break}return r.abrupt("return");case 4:r.t0=p,r.next="ENCRYPTED"===r.t0?7:"AUTH:JOIN"===r.t0?9:"AUTH:ADMITTED"===r.t0?11:21;break;case 7:return console.log("Ignoring encrypted message"),r.abrupt("break",23);case 9:return console.log("Well this is awkward. The peer without a Team is being asked to respond to an AUTH:JOIN event. All we can do is ignore it"),r.abrupt("break",23);case 11:return b=v,y=f.createUser({userName:n.username,deviceName:"Laptop",deviceType:1,seed:n.invitationSeed}),(g=new f.Team({source:b,context:{user:y}})).encrypt('Just testing for runtime error. Howdy Everyone! If this fails then BUG???? none of the lockboxes have a publicKey that matches the ephemeral one for this invitee. Ensure that the code for the tempkeys in Auth.Team.join are seeded with "invitationSeed" instead of "this.seed"'),g.join(s),o.removeEventListener(h.MESSAGE,i),a(g),r.next=20,m().addTeam(e,t,g);case 20:return r.abrupt("break",23);case 21:throw console.error(u),new Error('BUG: unsupported message action "'.concat(p,'"'));case 23:case"end":return r.stop()}}),c)})))}))})));case 6:case"end":return a.stop()}}),a)})))}},191:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toArray=void 0;t.toArray=function(e){return null===e?[]:Array.isArray(e)?e:[e]}},196:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(38),t),o(n(117),t),o(n(50),t),o(n(118),t),o(n(119),t),o(n(219),t),o(n(220),t)},201:function(e,t,n){e.exports=n(393)},219:function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItem=void 0;var o=n(22),a=n(38);t.MenuItem=function(e){var t=e.children,n=e.className,i=r(e,["children","className"]);return o.jsx(a.Button,Object.assign({className:["block ml-0 mr-0","w-full","text-left","rounded-t-none rounded-r-none rounded-b-none rounded-l-none ","border-t-0 border-r-0 border-b-0 border-l-0",n].join(" ")},i,{children:t}),void 0)}},220:function(e,t,n){"use strict";var r=n(17),o=n(63),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Toolbar=void 0;var s=n(22),c=i(n(222)),u=n(2),l=n(113),d=n(228),f=n(183),h=n(38),p=n(50),v=n(345),b=n(387),y=n(117),m=n(389);t.Toolbar=function(e){var t=e.storeManager,n=e.onStoreReady,i=e.children,g=l.useQueryParam("key",l.StringParam),k=o(g,2),O=k[0],w=k[1],E=u.useState(),_=o(E,2)[1],x=u.useState(!1),S=o(x,2),j=S[0],P=S[1];u.useEffect((function(){T("setup"),O?M(O):C()}),[]);var T=c.default("lf:toolbar:".concat(O));T("render");var C=function(){return a(void 0,void 0,void 0,r.mark((function e(){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(!0),o=f.randomDiscoveryKey(),w(o),e.next=5,t.createStore(o);case 5:return a=e.sent,e.next=8,t.listenToConnections(o);case 8:return _(a),n(a,o),P(!1),T("created store",o),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)})))},M=function(e){return a(void 0,void 0,void 0,r.mark((function o(){var a;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return");case 2:if(!j){r.next=4;break}return r.abrupt("return");case 4:return P(!0),w(e),r.next=8,t.joinStore(e);case 8:return a=r.sent,r.next=11,t.listenToConnections(e);case 11:_(a),n(a,e),P(!1),T("joined store",e);case 15:case"end":return r.stop()}}),o)})))},D=function(e){void 0!==e&&window.location.assign(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(location.protocol,"//").concat(location.host,"/?id=").concat(e)}(e))};return s.jsxs(y.Container,{children:[s.jsx(m.WelcomeMessage,{name:d.localUser.userName},void 0),s.jsx(b.TeamDropdown,{},void 0),s.jsx(p.Group,{children:s.jsx(h.Button,Object.assign({onClick:function(){return a(void 0,void 0,void 0,r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C();case 2:t=e.sent,setTimeout((function(){return D(t)}),200);case 4:case"end":return e.stop()}}),e)})))}},{children:"\ud83d\udcc4 New"}),void 0)},void 0),s.jsx(v.Status,{storeManager:t},void 0),i]},void 0)}},228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.localUser=void 0;var r=n(64),o=n(183);t.localUser=r.loadUser()||function(){var e=o.randomUserName();return r.createUser({userName:e,deviceName:"laptop",deviceType:1})}()},246:function(e,t){},252:function(e,t){},254:function(e,t){},26:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA=t.MESSAGE=t.PEER_UPDATE=t.PEER_REMOVE=t.PEER=t.ERROR=t.CLOSE=t.READY=t.OPEN=t.GLOBAL=t.DELETED=t.DEFAULT_RELAYS=t.INITIALIZE=t.RECEIVE_MESSAGE_FROM_PEER=void 0,t.RECEIVE_MESSAGE_FROM_PEER="@localfirst/state/RECEIVE_MESSAGE_FROM_PEER",t.INITIALIZE="@localfirst/state/INITIALIZE",t.DEFAULT_RELAYS=["https://cevitxe-signal.herokuapp.com","ws://".concat(window.location.hostname,":8080")],t.DELETED="__DELETED",t.GLOBAL="__global",t.OPEN="open",t.READY="ready",t.CLOSE="close",t.ERROR="error",t.PEER="peer",t.PEER_REMOVE="peer_remove",t.PEER_UPDATE="peer_update",t.MESSAGE="message",t.DATA="data"},263:function(e,t){},265:function(e,t){},291:function(e,t){},292:function(e,t){},297:function(e,t){},299:function(e,t){},306:function(e,t){},325:function(e,t){},345:function(e,t,n){"use strict";var r=n(63);Object.defineProperty(t,"__esModule",{value:!0}),t.Status=void 0;var o=n(22),a=n(112),i=n(2),s=n(50),c=n(386),u=n(26);t.Status=function(e){var t=e.storeManager,n=i.useState(!1),l=r(n,2),f=l[0],h=l[1],p=i.useState([]),v=r(p,2),b=v[0],y=v[1],m=function(e,t){y(t.map((function(t,n){return"".concat("ADMIN"===(t&&t.type)?"\ud83d\udc51":""," ").concat(t&&t.name?t.name:"?".concat(e[n],"?"))})))},g=function(){h(!0),y([])},k=function(){h(!1),y([])},O=function(){t.off(a.OPEN,g),t.off(a.CLOSE,k),t.off(a.PEER,m),t.off(a.PEER_REMOVE,m)};i.useEffect((function(){return t.on(a.OPEN,g),t.on(a.CLOSE,k),t.on(a.PEER,m),t.on(a.PEER_REMOVE,m),t.on(u.PEER_UPDATE,m),O}),[t]);var w=0===b.length?"no peers are connected":1===b.length?"one peer is connected":"".concat(b.length," other peers are connected"),E=f?"online; ".concat(w):"offline",_=b.map((function(e){return o.jsx("li",{children:o.jsxs("button",{children:[d(e),e]},void 0)},e)}));return o.jsxs(s.Group,Object.assign({title:E},{children:[o.jsxs("label",{children:[o.jsx(c.StatusLight,{online:f},void 0),f?o.jsxs("span",Object.assign({style:{marginLeft:".5em"}},{children:[b.length," online"]}),void 0):""]},void 0),o.jsx("ul",{children:_},void 0)]}),void 0)};var l=["\ud83d\udc76","\ud83e\uddd2","\ud83e\uddd1","\ud83d\udc71","\ud83e\uddd4","\ud83d\udc68\u200d\ud83e\uddb0","\ud83d\udc68\u200d\ud83e\uddb3","\ud83d\udc69","\ud83d\udc69\u200d\ud83e\uddb0","\ud83e\uddd1\u200d\ud83e\uddb0","\ud83d\udc69\u200d\ud83e\uddb1","\ud83e\uddd1\u200d\ud83e\uddb3","\ud83d\udc71\u200d\u2640\ufe0f","\ud83e\uddd3"];function d(e){return e.endsWith("?")?null:l[Math.abs((t=e,t.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))%l.length];var t}},346:function(e,t,n){"use strict";var r=n(32),o=n(17),a=n(35),i=n(45),s=n(71),c=n(108),u=n(109),l=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),d=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),f=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&l(t,e,n);return d(t,e),t},h=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StoreManager=void 0;var v=n(110),b=p(n(58)),y=p(n(186)),m=p(n(46)),g=n(18),k=n(74),O=n(357),w=f(n(64)),E=p(n(358)),_=n(362),x=n(26),S=n(369),j=n(370),P=n(371),T=n(72),C=n(190),M=(m.default("lf:StoreManager"),function(e){c(n,e);var t=u(n);function n(e){var r,i=e.databaseName,c=e.proxyReducer,u=e.initialState,l=e.urls,d=void 0===l?x.DEFAULT_RELAYS:l,f=e.middlewares,p=void 0===f?[]:f,b=e.collections,y=void 0===b?[]:b;return a(this,n),(r=t.call(this)).joinStore=function(e){return r.getStore(e,!1)},r.createStore=function(e){return r.getStore(e,!0)},r.getStore=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return h(s(r),void 0,void 0,o.mark((function n(){var r,a;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.log("".concat(t?"creating":"joining"," ").concat(e)),!this.store){n.next=3;break}return n.abrupt("return",this.store);case 3:return r=localStorage.getItem("clientId")||v.newid(),localStorage.setItem("clientId",r),this.repo=new P.Repo({clientId:r,discoveryKey:e,databaseName:this.databaseName,collections:this.collections}),n.next=8,this.repo.init(this.initialState,t);case 8:return a=n.sent,this.store=this.createReduxStore(a),n.abrupt("return",this.store);case 11:case"end":return n.stop()}}),n,this)})))},r.close=function(){return h(s(r),void 0,void 0,o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("closing"),!this.connectionManager){e.next=4;break}return e.next=4,this.connectionManager.close();case 4:delete this.repo,delete this.store;case 6:case"end":return e.stop()}}),e,this)})))},r.proxyReducer=c,r.middlewares=p,r.initialState=u,r.databaseName=i,r.urls=d,r.collections=y,r.log=m.default("lf:storemanager"),r}return i(n,[{key:"listenToConnections",value:function(e){return h(this,void 0,void 0,o.mark((function t(){var n,r,a,i,s,c,u,l,d,f,h,p;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.getTeamManager().instantiateTeamIfAvailable(T.ensure(this.repo),e);case 2:if(!(r=t.sent)){t.next=7;break}n=r,t.next=23;break;case 7:if(a=E.default.parse(window.location.search,{parseBooleans:!1,parseNumbers:!1,arrayFormat:"none"}),i=a.invitationUser,s=a.invitationSeed,!i||!s){t.next=12;break}n={username:i.toString(),invitationSeed:s.toString()},t.next=23;break;case 12:if(!confirm("You were not given an invitation to this page. Do you want to create a new Team?")){t.next=21;break}return c=w.createUser({userName:"Alice",deviceName:"Laptop",deviceType:1}),u=w.createTeam("dream",{user:c}),t.next=17,C.getTeamManager().instantiateTeamDefinitely(T.ensure(this.repo),e,u.chain);case 17:l=t.sent,n=l,t.next=23;break;case 21:throw alert("You have chosen not to create or join a team. There is nothing left to do. Closing."),new Error("Did not choose to join a team or create a new team");case 23:n instanceof w.Team&&n.memberIsAdmin(n.userName)&&(d="Friend".concat(new Number(Math.round(65536*Math.random())).toString()),f=n.invite(d),h=f.invitationSeed,p=E.default.stringify(Object.assign(Object.assign({},E.default.parse(window.location.search)),{invitationUser:d,invitationSeed:h})),window.history.replaceState(null,"","?".concat(p)),alert("Invite a person by copying and pasting the URL in the browser to your friend")),this.connectionManager=new _.ConnectionManager({invitationOrTeam:n,discoveryKey:e,dispatch:T.ensure(this.store).dispatch,repo:T.ensure(this.repo),urls:this.urls}),D({source:this.connectionManager,target:this,events:[x.OPEN,x.CLOSE,x.PEER,x.PEER_REMOVE,x.PEER_UPDATE]});case 26:case"end":return t.stop()}}),t,this)})))}},{key:"createReduxStore",value:function(e){if(!this.repo)throw new Error("Can't create Redux store without repo");var t=j.getReducer(this.proxyReducer,this.repo),n=S.getMiddleware(this.repo,this.proxyReducer),o=O.composeWithDevTools(k.applyMiddleware.apply(k,r(this.middlewares).concat([n])));return k.createStore(t,e,o)}},{key:"connectionCount",get:function(){if(!this.connectionManager)throw new Error("no connectionManager");return this.connectionManager.connectionCount}}]),n}(g.EventEmitter));t.StoreManager=M,b.default.uuid.setFactory(y.default);var D=function(e){var t=e.source,n=e.target;return e.events.forEach((function(e){return t.on(e,(function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return n.emit.apply(n,[e].concat(r))}))}))}},362:function(e,t,n){"use strict";var r=n(17),o=n(35),a=n(45),i=n(71),s=n(108),c=n(109),u=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&u(t,e,n);return l(t,e),t},f=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionManager=void 0;var p=n(110),v=h(n(46)),b=n(18),y=d(n(64)),m=n(363),g=n(26),k=n(190),O=v.default("lf:connectionmanager"),w=function(e){s(n,e);var t=c(n);function n(e){var a,s=e.invitationOrTeam,c=e.repo,u=e.dispatch,l=e.discoveryKey,d=e.urls,h=e.clientId,v=void 0===h?p.newid():h;return o(this,n),(a=t.call(this)).connections={},a.addPeer=function(e,t){return f(i(a),void 0,void 0,r.mark((function n(){var o,a,i,s=this;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.dispatch&&this.repo){n.next=2;break}return n.abrupt("return");case 2:if(o=e.get(t),!(this.invitationOrTeam instanceof y.Team)){n.next=9;break}return n.next=6,this.invitationOrTeam;case 6:a=n.sent,n.next=13;break;case 9:return n.next=11,k.performAuthHandshake(this.repo,this.discoveryKey,this.invitationOrTeam,o);case 11:a=n.sent,this.invitationOrTeam=a;case 13:o&&(i=new m.Connection(a,this.repo,o,this.dispatch),this.connections[e.id]=i,i.on(g.PEER_UPDATE,(function(){return s.emit(g.PEER_UPDATE,Object.keys(s.connections),Object.values(s.connections).map((function(e){return e.getAuthenticatedUser()})))}))),e.on(g.CLOSE,(function(){return s.removePeer(e.id)})),this.emit(g.PEER,Object.keys(this.connections),Object.values(this.connections).map((function(e){return e.getAuthenticatedUser()}))),O("added peer",e.id);case 17:case"end":return n.stop()}}),n,this)})))},a.removePeer=function(e){a.connections[e]&&a.connections[e].close(),delete a.connections[e],a.emit(g.PEER_REMOVE,Object.keys(a.connections),Object.values(a.connections).map((function(e){return e.getAuthenticatedUser()}))),O("removed peer",e)},a.invitationOrTeam=s,a.repo=c,a.dispatch=u,a.discoveryKey=l,a.client=new p.Client({id:v,url:d[0]}),a.client.join(l),a.client.on(g.PEER,a.addPeer),a.client.on(g.OPEN,(function(){return a.emit(g.OPEN)})),a.client.on(g.CLOSE,(function(){return a.emit(g.CLOSE)})),a}return a(n,[{key:"close",value:function(){return f(this,void 0,void 0,r.mark((function e(){var t,n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.keys(this.connections).map((function(e){return n.removePeer(e)})),e.next=3,Promise.all(t);case 3:this.connections={};case 4:case"end":return e.stop()}}),e,this)})))}},{key:"connectionCount",get:function(){return Object.keys(this.connections).length}}]),n}(b.EventEmitter);t.ConnectionManager=w},363:function(e,t,n){"use strict";var r=n(17),o=n(35),a=n(71),i=n(108),s=n(109),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;var l=u(n(46)),d=n(18),f=n(26),h=n(364),p=l.default("lf:connection"),v=function(e){i(n,e);var t=s(n);function n(e,i,s,u){var l;return o(this,n),(l=t.call(this)).receive=function(e){var t=e.data;return c(a(l),void 0,void 0,r.mark((function e(){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=JSON.parse(t.toString()),p("receive %o",o),"AUTH:JOIN"!==o.action){e.next=16;break}a=o.payload,e.prev=4,this.team.admit(a),p("admitted user to team"),null===(n=this.peerSocket)||void 0===n||n.send(JSON.stringify({action:"AUTH:ADMITTED",payload:this.team.chain})),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),console.error("Admission to team failed",e.t0),e.abrupt("return");case 14:e.next=33;break;case 16:if("ENCRYPTED"!==o.action){e.next=29;break}e.prev=17,o=JSON.parse(this.team.decrypt(o.envelope)),e.next=25;break;case 21:return e.prev=21,e.t1=e.catch(17),console.error(e.t1),e.abrupt("return");case 25:if(this.team.verify(o)){e.next=27;break}throw new Error("ERROR! Signed with unknown keys");case 27:JSON.stringify(this.authenticatedUser)!==JSON.stringify(o.author)&&(this.authenticatedUser=o.author,this.emit(f.PEER_UPDATE,this.authenticatedUser)),o=o.contents;case 29:return this.emit("receive",o),e.next=32,this.Synchronizer.receive(o);case 32:this.dispatch({type:f.RECEIVE_MESSAGE_FROM_PEER});case 33:case"end":return e.stop()}}),e,this,[[4,10],[17,21]])})))},l.send=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={action:"ENCRYPTED",envelope:l.team.encrypt(l.team.sign(e))};if(l.peerSocket)try{t?(p("send plaintext %o",JSON.stringify(e)),l.peerSocket.send(JSON.stringify(e))):(p("send encrypted %o",JSON.stringify(e)),l.peerSocket.send(JSON.stringify(n)))}catch(r){p("tried to send but peer is no longer connected",l.peerSocket)}},l.close=function(){l.peerSocket&&(l.peerSocket.close(),l.peerSocket=null)},l.getAuthenticatedUser=function(){return l.authenticatedUser},p("new connection"),l.team=e,l.repo=i,l.peerSocket=s,l.dispatch=u,l.peerSocket.onmessage=l.receive.bind(a(l)),l.Synchronizer=new h.Synchronizer(l.repo,l.send),l.Synchronizer.open().then((function(){return l.emit("ready")})),l}return n}(d.EventEmitter);t.Connection=v},364:function(e,t,n){"use strict";var r=n(47),o=n(17),a=n(35),i=n(45),s=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),c=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return c(t,e),t},l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},d=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Synchronizer=void 0;var h=f(n(58)),p=f(n(46)),v=n(189),b=u(n(366)),y=function(){function e(t,n){var r=this;a(this,e),this.isOpen=!1,this.getOurClock=function(e){return r.repo.getClock(e)},this.getTheirClock=function(e){return r.theirClock[e]},this.repo=t,this.send=n,this.theirClock={},this.log=p.default("lf:synchronizer:".concat(t.databaseName))}return i(e,[{key:"open",value:function(){return l(this,void 0,void 0,o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("open"),this.isOpen=!0,this.repo.addListener(this.onDocChanged.bind(this)),e.next=5,this.sendHello();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){this.log("close"),this.isOpen=!1,this.repo.removeListener(this.onDocChanged.bind(this))}},{key:"receive",value:function(e){return l(this,void 0,void 0,o.mark((function t(){var n,a,i,s,c,u,l,d,f,h,p,y,m,g,k,O,w,E,_;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isOpen){t.next=2;break}return t.abrupt("return");case 2:this.log("receive",e),t.t0=e.type,t.next=t.t0===b.HELLO?6:t.t0===b.SEND_CHANGES?23:t.t0===b.ADVERTISE_DOCS?31:t.t0===b.REQUEST_DOCS?55:t.t0===b.SEND_HISTORY?75:t.t0===b.SEND_SNAPSHOTS?79:82;break;case 6:if(n=+e.documentCount,a=+this.repo.count,this.log("received hello ",{theirCount:n,ourCount:a}),0!==n||0!==a){t.next=13;break}this.log("nothing to do"),t.next=22;break;case 13:if(!(0===n&&a>0)){t.next=19;break}this.log("sending everything"),this.sendSnapshots(),this.sendHistory(),t.next=22;break;case 19:return this.log("advertising everything"),t.next=22,this.advertiseAll();case 22:return t.abrupt("break",82);case 23:if(i=e.documentId,s=e.changes,c=e.clock,this.updateTheirClock(i,c),u=this.getOurClock(i),!v.isMoreRecent(c,u)){t.next=30;break}return t.next=30,this.repo.applyChanges(i,s);case 30:return t.abrupt("break",82);case 31:l=e.clocks,d=r(l),t.prev=33,d.s();case 35:if((f=d.n()).done){t.next=46;break}if(h=f.value,p=h.documentId,y=h.clock,this.updateTheirClock(p,y),!this.repo.has(p)){t.next=43;break}return t.next=41,this.maybeSendChanges(p);case 41:t.next=44;break;case 43:this.requestDoc(p);case 44:t.next=35;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(33),d.e(t.t1);case 51:return t.prev=51,d.f(),t.finish(51);case 54:return t.abrupt("break",82);case 55:m=e.documentIds,g=r(m),t.prev=57,g.s();case 59:if((k=g.n()).done){t.next=66;break}return O=k.value,this.updateTheirClock(O,v.EMPTY_CLOCK),t.next=64,this.maybeSendChanges(O);case 64:t.next=59;break;case 66:t.next=71;break;case 68:t.prev=68,t.t2=t.catch(57),g.e(t.t2);case 71:return t.prev=71,g.f(),t.finish(71);case 74:return t.abrupt("break",82);case 75:return w=e.history,t.next=78,this.receiveHistory(w);case 78:return t.abrupt("break",82);case 79:return E=e.state,_=e.clocks,this.receiveSnapshots(E,_),t.abrupt("break",82);case 82:case"end":return t.stop()}}),t,this,[[33,48,51,54],[57,68,71,74]])})))}},{key:"onDocChanged",value:function(e){return l(this,void 0,void 0,o.mark((function t(){return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.maybeSendChanges(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"sendHello",value:function(){return l(this,void 0,void 0,o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.repo.count,this.log("sending hello",t),this.send({type:b.HELLO,documentCount:t},!0);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"maybeSendChanges",value:function(e){return l(this,void 0,void 0,o.mark((function t(){var n,r,a,i;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getTheirClock(e),r=this.getOurClock(e),!v.isMoreRecent(r,n)){t.next=12;break}return t.next=5,this.repo.get(e);case 5:if(void 0!==(a=t.sent)){t.next=8;break}return t.abrupt("return");case 8:if(!((i=n?v.getMissingChanges(a,n):h.default.getChanges(h.default.init(),a)).length>0)){t.next=12;break}return t.next=12,this.sendChanges(e,i);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"sendChanges",value:function(e,t){return l(this,void 0,void 0,o.mark((function n(){var r;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.log("sendChanges",e),r=this.getOurClock(e),this.send({type:b.SEND_CHANGES,documentId:e,clock:r,changes:t});case 3:case"end":return n.stop()}}),n,this)})))}},{key:"advertiseAll",value:function(){return l(this,void 0,void 0,o.mark((function e(){var t,n=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.log("advertiseAll"),t=Object.keys(this.repo.getAllClocks()).map((function(e){return{documentId:e,clock:n.getOurClock(e)}})),this.send({type:b.ADVERTISE_DOCS,clocks:t});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"requestDoc",value:function(e){this.send({type:b.REQUEST_DOCS,documentIds:[e]})}},{key:"sendSnapshots",value:function(){var e=this.repo.getState(),t=this.repo.getAllClocks();this.log("sendSnapshots",e),this.send({type:b.SEND_SNAPSHOTS,state:e,clocks:t})}},{key:"sendHistory",value:function(){var e,t;return l(this,void 0,void 0,o.mark((function n(){var r,a,i;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,r=d(this.repo.getHistory(1e3));case 2:return n.next=4,r.next();case 4:if((a=n.sent).done){n.next=11;break}i=a.value,this.log("sendHistory",Object.keys(i).length),this.send({type:b.SEND_HISTORY,history:i});case 9:n.next=2;break;case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(0),e={error:n.t0};case 16:if(n.prev=16,n.prev=17,!a||a.done||!(t=r.return)){n.next=21;break}return n.next=21,t.call(r);case 21:if(n.prev=21,!e){n.next=24;break}throw e.error;case 24:return n.finish(21);case 25:return n.finish(16);case 26:case"end":return n.stop()}}),n,this,[[0,13,16,26],[17,,21,25]])})))}},{key:"receiveHistory",value:function(e){return l(this,void 0,void 0,o.mark((function t(){return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.log("receiveHistory",e),t.next=3,this.repo.loadHistory(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"receiveSnapshots",value:function(e,t){for(var n in this.log("receiveSnapshots",e),this.repo.setState(e),t)this.updateTheirClock(n,t[n])}},{key:"updateTheirClock",value:function(e,t){return l(this,void 0,void 0,o.mark((function n(){var r;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=this.theirClock[e]||v.EMPTY_CLOCK,this.theirClock[e]=v.mergeClocks(r,t);case 2:case"end":return n.stop()}}),n,this)})))}}]),e}();t.Synchronizer=y},366:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEND_SNAPSHOTS=t.SEND_HISTORY=t.SEND_CHANGES=t.ADVERTISE_DOCS=t.REQUEST_DOCS=t.HELLO=void 0,t.HELLO="HELLO",t.REQUEST_DOCS="REQUEST_DOCS",t.ADVERTISE_DOCS="ADVERTISE_DOCS",t.SEND_CHANGES="SEND_CHANGES",t.SEND_HISTORY="SEND_HISTORY",t.SEND_SNAPSHOTS="SEND_SNAPSHOTS"},369:function(e,t,n){"use strict";var r=n(17),o=n(47),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMiddleware=void 0;var s=i(n(46)),c=n(26),u=n(191),l=s.default("lf:middleware");t.getMiddleware=function(e,t){return function(n){return function(i){return function(s){return a(void 0,void 0,void 0,r.mark((function a(){var d,f,h,p,v;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(d=i(s),l("%o",{action:s}),s.type!==c.RECEIVE_MESSAGE_FROM_PEER){r.next=5;break}r.next=26;break;case 5:if(null!==(f=t(n.getState(),s))){r.next=9;break}r.next=26;break;case 9:h=o(u.toArray(f)),r.prev=10,h.s();case 12:if((p=h.n()).done){r.next=18;break}return v=p.value,r.next=16,e.applyChangeManifest(v);case 16:r.next=12;break;case 18:r.next=23;break;case 20:r.prev=20,r.t0=r.catch(10),h.e(r.t0);case 23:return r.prev=23,h.f(),r.finish(23);case 26:return r.abrupt("return",d);case 27:case"end":return r.stop()}}),a,null,[[10,20,23,26]])})))}}}}},370:function(e,t,n){"use strict";var r=n(47);Object.defineProperty(t,"__esModule",{value:!0}),t.getReducer=void 0;var o=n(26),a=n(191);t.getReducer=function(e,t){return function(n,i){if(i.type===o.RECEIVE_MESSAGE_FROM_PEER);else{var s=e(n,i);if(null===s);else{t.setState(n||{});var c,u=r(a.toArray(s));try{for(u.s();!(c=u.n()).done;){var l=c.value;t.applyChangeManifest(l,!0)}}catch(d){u.e(d)}finally{u.f()}}}return t.getState()}}},371:function(e,t,n){"use strict";var r=n(372),o=n(47),a=n(17),i=n(35),s=n(45),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},u=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},l=this&&this.__await||function(e){return this instanceof l?(this.v=e,this):new l(e)},d=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof l?Promise.resolve(n.value.v).then(c,u):d(a[0][2],n)}catch(r){d(a[0][3],r)}var n}function c(e){s("next",e)}function u(e){s("throw",e)}function d(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Repo=void 0;var h=n(110),p=n(373),v=f(n(58)),b=f(n(46)),y=n(194),m=n(189),g=n(385),k=n(26),O=n(72),w=function(){function e(t){var n=this,r=t.discoveryKey,o=t.databaseName,s=t.clientId,u=void 0===s?h.newid():s,l=t.storage,d=void 0===l?new p.IdbAdapter({databaseName:o,discoveryKey:r}):l,f=t.collections,v=void 0===f?[]:f;i(this,e),this.state={},this.clock={},this.listeners=new Set,this.open=function(){return c(n,void 0,void 0,a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.open();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))},this.close=function(){return c(n,void 0,void 0,a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.close();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))},this.log=b.default("lf:repo:".concat(o)),this.databaseName=o,this.clientId=u,this.collections=v,this.storage=d}return s(e,[{key:"init",value:function(e,t){return c(this,void 0,void 0,a.mark((function n(){var r;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.open();case 2:return n.next=4,this.hasData();case 4:if(r=n.sent,!t){n.next=10;break}return n.next=8,this.create(e);case 8:n.next=16;break;case 10:if(r){n.next=14;break}this.log("joining a peer's document for the first time"),n.next=16;break;case 14:return n.next=16,this.load();case 16:return n.abrupt("return",this.getState());case 17:case"end":return n.stop()}}),n,this)})))}},{key:"has",value:function(e){return this.state.hasOwnProperty(e)}},{key:"get",value:function(e){return c(this,void 0,void 0,a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.reconstruct(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"set",value:function(e,t,n){return c(this,void 0,void 0,a.mark((function r(){var i,s,c,u;return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=8;break}return r.next=3,this.reconstruct(e);case 3:if(r.t0=r.sent,r.t0){r.next=6;break}r.t0=v.default.init();case 6:i=r.t0;try{n=v.default.getChanges(i,t)}catch(a){this.log({error:a,oldDoc:i,doc:t}),n=[]}case 8:if(!(n.length>0)){r.next=30;break}return r.next=11,this.appendChanges({documentId:e,changes:n});case 11:return r.next=13,this.saveSnapshot(e,t);case 13:s=o(this.listeners),r.prev=14,s.s();case 16:if((c=s.n()).done){r.next=22;break}return u=c.value,r.next=20,u(e,t);case 20:r.next=16;break;case 22:r.next=27;break;case 24:r.prev=24,r.t1=r.catch(14),s.e(r.t1);case 27:return r.prev=27,s.f(),r.finish(27);case 30:case"end":return r.stop()}}),r,this,[[14,24,27,30]])})))}},{key:"change",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.collectionName,o=n.snapshotOnly,i=void 0!==o&&o;return c(this,void 0,void 0,a.mark((function n(){var o,s,c,u,l,d;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=r?new g.Collection(r).idToKey(e):e,!i){n.next=8;break}s=v.default.from(y.clone(this.getSnapshot(o)||{})),c=v.default.change(s,t),u=y.clone(c),this.setSnapshot(o,u),n.next=17;break;case 8:return n.next=10,this.reconstruct(o);case 10:if(n.t0=n.sent,n.t0){n.next=13;break}n.t0=v.default.init();case 13:return l=n.t0,d=v.default.change(l,t),n.next=17,this.set(o,d);case 17:case"end":return n.stop()}}),n,this)})))}},{key:"applyChanges",value:function(e,t){return c(this,void 0,void 0,a.mark((function n(){var r,o;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.reconstruct(e);case 2:if(n.t0=n.sent,n.t0){n.next=5;break}n.t0=v.default.init();case 5:return r=n.t0,o=v.default.applyChanges(r,t),n.next=9,this.set(e,o,t);case 9:return n.abrupt("return",o);case 10:case"end":return n.stop()}}),n,this)})))}},{key:"drop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(this,void 0,void 0,a.mark((function n(){var r,i,s,c;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=function(t){return new g.Collection(e).isCollectionKey(t)},i=o(this.ids.filter(r)),n.prev=2,i.s();case 4:if((s=i.n()).done){n.next=14;break}if(c=s.value,!t){n.next=10;break}this.deleteSnapshot(c),n.next=12;break;case 10:return n.next=12,this.change(c,E);case 12:n.next=4;break;case 14:n.next=19;break;case 16:n.prev=16,n.t0=n.catch(2),i.e(n.t0);case 19:return n.prev=19,i.f(),n.finish(19);case 22:case"end":return n.stop()}}),n,this,[[2,16,19,22]])})))}},{key:"applyChangeManifest",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c(this,void 0,void 0,a.mark((function n(){var r,o,i;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!O.isDropFlag(e)){n.next=5;break}return n.next=3,this.drop(e.collection,t);case 3:n.next=10;break;case 5:return r=O.isFunction(e)?e:O.isDeleteFlag(e)?E:e.fn,o=O.isFunction(e)?k.GLOBAL:e.id,i=O.isFunction(e)?void 0:e.collection,n.next=10,this.change(o,r,{collectionName:i,snapshotOnly:t});case 10:case"end":return n.stop()}}),n,this)})))}},{key:"getHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return d(this,arguments,a.mark((function t(){var n,r,o,i,s,c,d,f,h;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o={},i=0,t.prev=2,s=u(this.storage.changes());case 4:return t.next=6,l(s.next());case 6:if((c=t.sent).done){t.next=19;break}if(d=c.value,f=d.documentId,h=d.changes,o[f]=(o[f]||[]).concat(h),!(i++>e)){t.next=17;break}return t.next=13,l(o);case 13:return t.next=15,t.sent;case 15:i=0,o={};case 17:t.next=4;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(2),n={error:t.t0};case 24:if(t.prev=24,t.prev=25,!c||c.done||!(r=s.return)){t.next=29;break}return t.next=29,l(r.call(s));case 29:if(t.prev=29,!n){t.next=32;break}throw n.error;case 32:return t.finish(29);case 33:return t.finish(24);case 34:return t.next=36,l(o);case 36:return t.next=38,t.sent;case 38:case"end":return t.stop()}}),t,this,[[2,21,24,34],[25,,29,33]])})))}},{key:"loadHistory",value:function(e){return c(this,void 0,void 0,a.mark((function t(){var n,r;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=a.keys(e);case 1:if((t.t1=t.t0()).done){t.next=8;break}return n=t.t1.value,r=e[n],t.next=6,this.applyChanges(n,r);case 6:t.next=1;break;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getSnapshot",value:function(e){return this.state[e]}},{key:"setSnapshot",value:function(e,t){t.DELETED?this.deleteSnapshot(e):this.state[e]=t}},{key:"deleteSnapshot",value:function(e){this.state[e]=null}},{key:"getState",value:function(){return g.Collection.denormalize(this.state,this.collections)}},{key:"setState",value:function(e){this.state=Object.assign(this.state,e)}},{key:"getClock",value:function(e){return this.clock[e]||m.EMPTY_CLOCK}},{key:"getAllClocks",value:function(){return this.clock}},{key:"updateClock",value:function(e,t){var n=this.clock[e];this.clock[e]=m.mergeClocks(n,t)}},{key:"addListener",value:function(e){this.listeners.add(e)}},{key:"removeListener",value:function(e){this.listeners.delete(e)}},{key:"hasData",value:function(){return c(this,void 0,void 0,a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.hasData());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"create",value:function(e){return c(this,void 0,void 0,a.mark((function t(){var n,r,o,i;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.log("creating a new repo from initial state"),n=g.Collection.normalize(e,this.collections),t.t0=a.keys(n);case 3:if((t.t1=t.t0()).done){t.next=12;break}if(r=t.t1.value,null===(o=n[r])){t.next=10;break}return i=v.default.from(o),t.next=10,this.set(r,i);case 10:t.next=3;break;case 12:case"end":return t.stop()}}),t,this)})))}},{key:"load",value:function(){var e,t;return c(this,void 0,void 0,a.mark((function n(){var r,o,i,s,c,l;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.log("recovering an existing repo from persisted state"),n.prev=1,r=u(this.storage.snapshots());case 3:return n.next=5,r.next();case 5:if((o=n.sent).done){n.next=12;break}i=o.value,s=i.documentId,c=i.snapshot,l=i.clock,this.state[s]=c[k.DELETED]?null:c,this.clock[s]=l;case 10:n.next=3;break;case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(1),e={error:n.t0};case 17:if(n.prev=17,n.prev=18,!o||o.done||!(t=r.return)){n.next=22;break}return n.next=22,t.call(r);case 22:if(n.prev=22,!e){n.next=25;break}throw e.error;case 25:return n.finish(22);case 26:return n.finish(17);case 27:case"end":return n.stop()}}),n,this,[[1,14,17,27],[18,,22,26]])})))}},{key:"reconstruct",value:function(e){return c(this,void 0,void 0,a.mark((function t(){var n,r,i,s,c;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.has(e)){t.next=2;break}return t.abrupt("return",void 0);case 2:return n=v.default.init({actorId:this.clientId}),t.next=5,this.getChanges(e);case 5:r=t.sent,i=o(r);try{for(i.s();!(s=i.n()).done;)(c=s.value.changes)&&(n=v.default.applyChanges(n,c))}catch(a){i.e(a)}finally{i.f()}return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"appendChanges",value:function(e){return c(this,void 0,void 0,a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.storage.appendChanges(e);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getChanges",value:function(e){return c(this,void 0,void 0,a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.storage.getChanges(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"saveSnapshot",value:function(e,t){return c(this,void 0,void 0,a.mark((function n(){var r,o;return a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=y.clone(t),o=m.getClock(t),this.updateClock(e,o),!r[k.DELETED]){n.next=9;break}return this.deleteSnapshot(e),n.next=7,this.storage.deleteSnapshot(e);case 7:n.next=12;break;case 9:return this.setSnapshot(e,r),n.next=12,this.storage.putSnapshot({documentId:e,snapshot:r,clock:o});case 12:case"end":return n.stop()}}),n,this)})))}},{key:"count",get:function(){return this.ids.length}},{key:"ids",get:function(){return Object.keys(this.state)}}]),e}();t.Repo=w;var E=function(e){return Object.assign(e||{},r({},k.DELETED,!0))}},373:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},s=this&&this.__await||function(e){return this instanceof s?(this.v=e,this):new s(e)},c=this&&this.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||c(e,t)}))})}function c(e,t){try{(n=o[e](t)).value instanceof s?Promise.resolve(n.value.v).then(u,l):d(a[0][2],n)}catch(r){d(a[0][3],r)}var n}function u(e){c("next",e)}function l(e){c("throw",e)}function d(e,t){e(t),a.shift(),a.length&&c(a[0][0],a[0][1])}},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IdbAdapter=void 0;var l=n(374),d=u(n(376)),f=n(379),h=function(e){function t(t){var n=e.call(this,t)||this;return n.log=d.default("lf:idbadapter:"+n.storageKey),n}return r(t,e),t.prototype.open=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=this,[4,f.openDB(this.storageKey,p,{upgrade:function(e){e.createObjectStore("changes",{keyPath:"id",autoIncrement:!0}).createIndex("by-documentId","documentId"),e.createObjectStore("snapshots",{keyPath:"documentId",autoIncrement:!1}).createIndex("by-documentId","documentId")}})];case 1:return e.database=t.sent(),this.log("opened",this.database.name),[2]}}))}))},t.prototype.close=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.database&&(this.database.close(),delete this.database,this.log("closed")),[2]}))}))},t.prototype.snapshots=function(){return c(this,arguments,(function(){var e,t,n,r,o,c,u;return a(this,(function(a){switch(a.label){case 0:this.ensureOpen(),e=this.database.transaction("snapshots").store.index("by-documentId"),a.label=1;case 1:a.trys.push([1,8,9,14]),t=i(e.iterate(void 0,"next")),a.label=2;case 2:return[4,s(t.next())];case 3:return(n=a.sent()).done?[3,7]:(r=n.value,[4,s(r.value)]);case 4:return[4,a.sent()];case 5:a.sent(),a.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return o=a.sent(),c={error:o},[3,14];case 9:return a.trys.push([9,,12,13]),n&&!n.done&&(u=t.return)?[4,s(u.call(t))]:[3,11];case 10:a.sent(),a.label=11;case 11:return[3,13];case 12:if(c)throw c.error;return[7];case 13:return[7];case 14:return[2]}}))}))},t.prototype.changes=function(){return c(this,arguments,(function(){var e,t,n,r,o,c,u;return a(this,(function(a){switch(a.label){case 0:this.ensureOpen(),e=this.database.transaction("changes").store.index("by-documentId"),a.label=1;case 1:a.trys.push([1,8,9,14]),t=i(e.iterate(void 0,"next")),a.label=2;case 2:return[4,s(t.next())];case 3:return(n=a.sent()).done?[3,7]:(r=n.value,[4,s(r.value)]);case 4:return[4,a.sent()];case 5:a.sent(),a.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return o=a.sent(),c={error:o},[3,14];case 9:return a.trys.push([9,,12,13]),n&&!n.done&&(u=t.return)?[4,s(u.call(t))]:[3,11];case 10:a.sent(),a.label=11;case 11:return[3,13];case 12:if(c)throw c.error;return[7];case 13:return[7];case 14:return[2]}}))}))},t.prototype.hasData=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.ensureOpen(),[4,this.database.count("changes")];case 1:return[2,e.sent()>0]}}))}))},t.prototype.getChanges=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){return this.ensureOpen(),[2,this.database.getAllFromIndex("changes","by-documentId",e)]}))}))},t.prototype.appendChanges=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.ensureOpen(),[4,this.database.add("changes",e)];case 1:return t.sent(),[2]}}))}))},t.prototype.putSnapshot=function(e){var t=e.documentId,n=e.snapshot,r=e.clock;return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.ensureOpen(),[4,this.database.put("snapshots",{documentId:t,snapshot:n,clock:r})];case 1:return e.sent(),[2]}}))}))},t.prototype.deleteSnapshot=function(e){return o(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.ensureOpen(),[4,this.database.delete("snapshots",e)];case 1:return t.sent(),[2]}}))}))},t.prototype.ensureOpen=function(){if(!this.database)throw new Error("The database has not been opened yet. Have you called `repo.open()`?")},t}(l.StorageAdapter);t.IdbAdapter=h;var p=1},374:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageAdapter=void 0;var a=function(e){var t=e.databaseName,n=e.discoveryKey;this.storageKey="@localfirst_state_"+t+"_"+n.substr(0,12)};t.StorageAdapter=a,o(n(375),t)},375:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},38:function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Button=void 0;var o=n(22);t.Button=function(e){var t=e.children,n=e.className,a=r(e,["children","className"]);return o.jsx("button",Object.assign({role:"button",type:"button",className:"block py-2 px-4  \n        font-mono text-sm leading-none uppercase text-gray-900 \n        bg-white hover:bg-blue-100 \n        rounded-md border border-gray-400 focus:outline-none focus:border-blue-500\n        cursor-pointer \n        ".concat(n)},a,{children:t}),void 0)}},385:function(e,t,n){"use strict";var r=n(47),o=n(17),a=n(35),i=n(45);Object.defineProperty(t,"__esModule",{value:!0}),t.Collection=void 0;var s=n(26),c=function(){function e(t){var n=this;a(this,e),this.idToKey=function(e){return"".concat(n.keyName,"__").concat(e)},this.keyToId=function(e){return e.replace("".concat(n.keyName,"__"),"")},this.name=t,this.keyName=e.getKeyName(t)}return i(e,[{key:"isCollectionKey",value:function(e){return e.startsWith("".concat(this.keyName,"__"))}},{key:"keys",value:o.mark((function e(){var t,n,r,a,i=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:{},e.t0=o.keys(t);case 2:if((e.t1=e.t0()).done){e.next=11;break}if(n=e.t1.value,r=t[n],a=r&&!r[s.DELETED],!this.isCollectionKey(n)||!a){e.next=9;break}return e.next=9,n;case 9:e.next=2;break;case 11:case"end":return e.stop()}}),e,this)}))}],[{key:"getKeyName",value:function(e){return"__".concat(e)}},{key:"getCollectionName",value:function(e){return e.replace(/^__/,"")}},{key:"normalize",value:function(t,n){var o,a=Object.assign({},t),i={},c=r(n);try{for(c.s();!(o=c.n()).done;){var u=o.value,l=a[u];for(var d in l){i[new e(u).idToKey(d)]=l[d]}delete a[u]}}catch(f){c.e(f)}finally{c.f()}return i[s.GLOBAL]=Object.assign({},a),i}},{key:"denormalize",value:function(t,n){var o,a=Object.assign({},t[s.GLOBAL]),i=r(n);try{for(i.s();!(o=i.n()).done;){var c,u=o.value,l={},d=new e(u),f=r(d.keys(t));try{for(f.s();!(c=f.n()).done;){var h=c.value,p=d.keyToId(h);t[h]&&!0!==t[h][s.DELETED]&&(l[p]=t[h])}}catch(v){f.e(v)}finally{f.f()}a[u]=l}}catch(v){i.e(v)}finally{i.f()}return a}}]),e}();t.Collection=c},386:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusLight=void 0;var r=n(22);t.StatusLight=function(e){var t=e.online;return r.jsx("div",Object.assign({css:o(t).statusLight},{children:r.jsx("span",{},void 0)}),void 0)};var o=function(e){return{statusLight:{display:"inline-block",span:{display:"block",width:10,height:10,borderRadius:"50%",border:"1px solid white",background:e?"green":"silver"}}}}},387:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TeamDropdown=void 0;var r=n(22),o=n(38),a=n(119),i=n(50),s=n(388);t.TeamDropdown=function(){return r.jsx(i.Group,{children:r.jsxs(a.DropdownWrapper,Object.assign({buttonText:"\ud83d\udc6a Team",disabled:!1},{children:[r.jsx("div",Object.assign({className:"py-2 px-4"},{children:r.jsx("h3",Object.assign({className:"font-bold"},{children:"3 members"}),void 0)}),void 0),r.jsx(s.Item,{children:"funny.coyote \ud83d\udc51"},void 0),r.jsx(s.Item,{children:"little.snake"},void 0),r.jsx(s.Item,{children:"mysterious.mongoose"},void 0),r.jsx("div",Object.assign({className:"py-2 px-4"},{children:r.jsx(o.Button,{children:"\u2709 Invite"},void 0)}),void 0)]}),void 0)},void 0)}},388:function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var o=n(22),a=n(38);t.Item=function(e){var t=e.children,n=e.className,i=r(e,["children","className"]);return o.jsx(a.Button,Object.assign({className:["block ml-0 mr-0","w-full","text-left normal-case","rounded-t-none rounded-r-none rounded-b-none rounded-l-none ","border-t-0 border-r-0 border-b-0 border-l-0",n].join(" ")},i,{children:t}),void 0)}},389:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WelcomeMessage=void 0;var r=n(22),o=n(50);t.WelcomeMessage=function(e){var t=e.name;return r.jsx(o.Group,{children:r.jsxs("label",{children:["Welcome, ",t,"!"]},void 0)},void 0)}},393:function(e,t,n){"use strict";n.r(t);var r,o=n(2),a=n.n(o),i=n(73),s=n.n(i),c=n(13),u=n(396);!function(e){e.ADD_TODO="ADD_TODO",e.TOGGLE_TODO="TOGGLE_TODO",e.EDIT_TODO="EDIT_TODO",e.DESTROY_TODO="DESTROY_TODO",e.SET_FILTER="SET_FILTER",e.CLEAR_COMPLETED="CLEAR_COMPLETED"}(r||(r={}));var l,d=function(e){return{type:r.ADD_TODO,payload:{content:e,id:Object(u.a)()}}},f=function(e){return{type:r.TOGGLE_TODO,payload:{id:e}}},h=function(e,t){return{type:r.EDIT_TODO,payload:{id:e,content:t}}},p=function(e){return{type:r.DESTROY_TODO,payload:{id:e}}},v=function(e){return{type:r.SET_FILTER,payload:{filter:e}}},b=function(){return{type:r.CLEAR_COMPLETED,payload:{}}},y=function(){var e=Object(o.useRef)(),t=Object(c.b)();return a.a.createElement("div",null,a.a.createElement("form",{onSubmit:function(n){if(n.preventDefault(),e&&e.current){var r=e.current.value.trim();if(0===r.length)return;t(d(r)),e.current.value=""}}},a.a.createElement("input",{className:"new-todo",placeholder:"What needs to be done?",ref:e,autoFocus:!0})))},m=n(30),g=n(75),k=function(e){return e[Math.floor(Math.random()*e.length)]},O=[g.predicates,g.objects],w=n(113),E=n(196),_=n(112);!function(e){e.ALL="All",e.INCOMPLETE="Active",e.COMPLETED="Completed"}(l||(l={}));var x=n(200),S=n.n(x)()("lf:todo:logger"),j=r.SET_FILTER,P=r.ADD_TODO,T=r.DESTROY_TODO,C=r.TOGGLE_TODO,M=r.EDIT_TODO,D=r.CLEAR_COMPLETED,A={visibilityFilter:l.ALL,todoList:[],todoMap:{}},R=[function(e){return function(t){return function(n){S("action",n),S("prev state",e.getState());var r=t(n);return S("next state",e.getState()),r}}}],N=new _.StoreManager({databaseName:"todo",proxyReducer:function(e,t){var n=t.type,r=t.payload;switch(n){case P:var o=r.id,a=r.content;return function(e){e.todoList.push(o),e.todoMap[o]={id:o,content:a,completed:!1}};case T:var i=r.id;return function(e){delete e.todoMap[i],e.todoList=e.todoList.filter((function(e){return e!==r.id}))};case C:var s=r.id;return function(e){return e.todoMap[s].completed=!e.todoMap[s].completed};case M:var c=r.id,u=r.content;return function(e){return e.todoMap[c].content=u};case j:return function(e){return e.visibilityFilter=r.filter};case D:return function(e){for(var t in e.todoList=e.todoList.filter((function(t){return!e.todoMap[t].completed})),e.todoMap)e.todoList.includes(t)||delete e.todoMap[t]};default:return null}},initialState:A,middlewares:R}),I=function(){var e=Object(w.useQueryParam)("key"),t=Object(m.a)(e,2),n=t[0],r=t[1],i=function(e,t){var n=Object(o.useState)(),r=Object(m.a)(n,2),a=r[0],i=r[1];return Object(o.useEffect)((function(){if(e)N.joinStore(e).then((function(e){return i(e)}));else{var n=t();N.createStore(n).then((function(e){return i(e)}))}}),[e]),a}(n,(function(){var e=O.map(k).join("-");return r(e),e})),s=Object(o.useState)(),u=Object(m.a)(s,2),l=(u[0],u[1]);return i?a.a.createElement(c.a,{store:i},a.a.createElement(E.Toolbar,{storeManager:N,onStoreReady:function(e){return l(e)}}),a.a.createElement(V,null)):null},L=n(36),U=n.n(L),H=function(e){var t=e.id,n=e.completed,r=e.content,i=Object(c.b)(),s=Object(o.useState)(!1),u=Object(m.a)(s,2),l=u[0],d=u[1],v=Object(o.useState)(r),b=Object(m.a)(v,2),y=b[0],g=b[1],k=Object(o.useRef)();Object(o.useEffect)((function(){l&&k.current&&k.current.select()}),[l,k]);var O=function(e){var n=e.target.value.trim();n.length>0?i(h(t,n)):i(p(t)),w()},w=function(){return d(!1)},E=function(){return g(r)};return a.a.createElement("li",{className:U()({completed:n,editing:l})},a.a.createElement("div",{className:"view"},a.a.createElement("input",{className:"toggle",type:"checkbox",checked:n,onChange:function(){return i(f(t))}}),a.a.createElement("label",{onClick:function(){return d(!0)}},r),a.a.createElement("button",{className:"destroy",style:{cursor:"pointer"},onClick:function(){return i(p(t))}})),a.a.createElement("input",{className:"edit",ref:k,value:y,onBlur:O,onChange:function(e){return g(e.target.value)},onKeyDown:function(e){"Escape"===e.key?(E(),w()):"Enter"===e.key&&O(e)}}))},G=n(116),F=function(e){return e&&e.todoList?e.todoList.map((function(t){return function(e){return function(t){return Object(G.a)(Object(G.a)({},t.todoMap[e]),{},{id:e})}}(t)(e)})):[]},B=function(e){return function(t){var n=F(t);switch(e){case l.ALL:return n;case l.INCOMPLETE:return n.filter((function(e){return!e.completed}));case l.COMPLETED:return n.filter((function(e){return e.completed}));default:throw new Error("Unknown visibility filter '".concat(e,"'"))}}},K=function(e){var t=function(e){return e&&e.visibilityFilter?e.visibilityFilter:l.ALL}(e);return B(t)(e)},Y=function(){var e=Object(c.c)(K);return a.a.createElement("ul",{className:"todo-list"},e&&e.map((function(e){return a.a.createElement(H,Object.assign({key:"todo-".concat(e.id)},e))})))};function V(){var e,t=Object(c.c)(B(l.INCOMPLETE)),n=Object(c.c)(B(l.ALL)),r=t.length,o=0===n.length;return a.a.createElement("div",{className:"main"},a.a.createElement("section",{className:"todoapp",style:{flexGrow:2}},a.a.createElement("header",{className:"header"},a.a.createElement("h1",null,"todos"),a.a.createElement(y,null)),a.a.createElement("section",{className:U()({main:!0,hidden:o})},a.a.createElement(Y,null)),a.a.createElement("footer",{className:U()({footer:!0,hidden:o})},a.a.createElement("span",{className:"todo-count"},a.a.createElement("strong",null,r)," ",(e="item",1===r?e:e+"s")," left"),a.a.createElement(J,null),a.a.createElement(W,null))))}var J=function(){var e=Object(c.c)((function(e){return e&&e.visibilityFilter?e.visibilityFilter:l.ALL})),t=Object(c.b)();return a.a.createElement("ul",{className:"filters"},Object.keys(l).map((function(n){var r=l[n],o=r===e;return a.a.createElement("li",{key:"visibility-filter-".concat(r)},a.a.createElement("a",{className:U()({selected:o}),onClick:function(e){e.preventDefault(),t(v(r))},style:{cursor:"pointer"}},r))})))};function W(){var e=Object(c.b)();if(0===Object(c.c)(B(l.COMPLETED)).length)return null;return a.a.createElement("button",{className:"clear-completed",onClick:function(){return e(b())}},"Clear completed")}var z=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function q(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(a.a.createElement(I,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/todo",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/todo","/service-worker.js");z?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):q(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):q(t,e)}))}}()},50:function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.Group=void 0;var o=n(22);t.Group=function(e){var t=e.children,n=r(e,["children"]);return o.jsx("div",Object.assign({className:"h-10 py-1 px-3 border-r border-gray-400 justify-center flex ",css:{minWidth:40,label:{margin:"auto",padding:"0 1em"}}},n,{children:t}),void 0)}},72:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.ensure=t.isDropFlag=t.isDeleteFlag=t.isChange=t.isFunction=void 0;t.isFunction=function(e){return"function"===typeof e};t.isChange=function(e){return e.hasOwnProperty("fn")};t.isDeleteFlag=function(e){return e.hasOwnProperty("delete")};t.isDropFlag=function(e){return e.hasOwnProperty("drop")},o(n(367),t),t.ensure=function(e){if(!e)throw new Error("BUG: Assertion failed and argument was undefined at this point in time");return e}}},[[201,1,2]]]);
//# sourceMappingURL=main.0f402d78.chunk.js.map